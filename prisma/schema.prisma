generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ArquivoImportado {
  id           String           @id @default(uuid())
  nomeArquivo  String
  tipo         String
  dataDownload DateTime?
  dataUpload   DateTime         @default(now())
  hashArquivo  String           @unique
  status       String           @default("ativo")
  excluidoEm   DateTime?
  excluidoPor  String?
  observacao   String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  linhas       LinhaImportada[]

  @@index([hashArquivo])
  @@index([dataUpload])
  @@index([status])
  @@map("arquivos_importados")
}

model LinhaImportada {
  id                 String           @id @default(uuid())
  arquivoId          String
  numeroLinha        Int
  dadosOriginais     Json
  identificadorChave String?
  tipoEntidade       String
  createdAt          DateTime         @default(now())
  alunos             Aluno[]
  enturmacoes        Enturmacao[]
  arquivo            ArquivoImportado @relation(fields: [arquivoId], references: [id], onDelete: Cascade)

  @@index([arquivoId])
  @@index([identificadorChave])
  @@index([tipoEntidade])
  @@map("linhas_importadas")
}

model Aluno {
  id                                String          @id @default(uuid())
  matricula                         String          @unique @db.VarChar(15)
  nome                              String?         @db.VarChar(200)
  sexo                              String?         @db.VarChar(1)
  dataNascimento                    DateTime?       @db.Date
  nacionalidade                     String?         @db.VarChar(50)
  naturalidade                      String?         @db.VarChar(100)
  uf                                String?         @db.VarChar(2)
  rg                                String?         @db.VarChar(20)
  rgOrgaoEmissor                    String?         @db.VarChar(20)
  rgDataEmissao                     DateTime?       @db.Date
  cpf                               String?         @db.VarChar(14)
  nomeMae                           String?         @db.VarChar(200)
  nomePai                           String?         @db.VarChar(200)
  dataConclusaoEnsinoMedio          DateTime?       @db.Date
  efInstituicao                     String?         @db.VarChar(200)
  efMunicipioEstado                 String?         @db.VarChar(100)
  efAnoConclusao                    Int?
  efNumeroPagina                    String?         @db.VarChar(20)
  efDataEmissao                     DateTime?       @db.Date
  dadosConferidos                   Boolean         @default(false)
  conferidoEm                       DateTime?
  conferidoPor                      String?
  certificacao                      Boolean         @default(false)
  observacoes                       String?         @db.VarChar(1000)
  origemTipo                        String
  linhaOrigemId                     String?
  fonteAusente                      Boolean         @default(false)
  fonteAusenteCiente                Boolean         @default(false)
  criadoEm                          DateTime        @default(now())
  criadoPor                         String?
  atualizadoEm                      DateTime        @updatedAt
  atualizadoPor                     String?
  dadosOriginais                    Json?
  situacaoEscolar                   String?         @db.VarChar(50)
  causaEncerramentoEscolar          String?         @db.VarChar(100)
  motivoEncerramento                String?         @db.VarChar(100)
  recebeOutroEspacoEscolar          String?         @db.VarChar(50)
  anoIngressoEscolar                Int?
  periodoIngressoEscolar            Int?
  dataInclusaoIngressoEscolar       DateTime?
  tipoIngressoEscolar               String?         @db.VarChar(50)
  redeOrigemIngressoEscolar         String?         @db.VarChar(100)
  matrizCurricularEscolar           String?         @db.VarChar(100)
  dataImportacaoTextoDadosEscolares DateTime?
  dataImportacaoTextoDadosPessoais  DateTime?
  textoBrutoDadosEscolares          String?         @db.Text
  textoBrutoDadosPessoais           String?         @db.Text
  tipoDocumento                     String?         @db.VarChar(20)
  complementoIdentidade             String?         @db.VarChar(100)
  cpfMae                            String?         @db.VarChar(14)
  cpfPai                            String?         @db.VarChar(14)
  dataEmissaoCertidao               DateTime?       @db.Date
  email                             String?         @db.VarChar(100)
  estadoCertidao                    String?         @db.VarChar(2)
  estadoCivil                       String?         @db.VarChar(50)
  estadoEmissao                     String?         @db.VarChar(2)
  folhaCertidao                     String?         @db.VarChar(20)
  livroCertidao                     String?         @db.VarChar(20)
  municipioCartorio                 String?         @db.VarChar(100)
  necessidadeEspecial               String?         @db.VarChar(200)
  nomeCartorio                      String?         @db.VarChar(200)
  nomeSocial                        String?         @db.VarChar(200)
  numeroCertidaoCivil               String?         @db.VarChar(100)
  numeroTermo                       String?         @db.VarChar(50)
  paisNascimento                    String?         @db.VarChar(100)
  tipoCertidaoCivil                 String?         @db.VarChar(50)
  ufCartorio                        String?         @db.VarChar(2)
  linhaOrigem                       LinhaImportada? @relation(fields: [linhaOrigemId], references: [id])
  enturmacoes                       Enturmacao[]
  seriesCursadas                    SerieCursada[]

  @@index([matricula])
  @@index([nome])
  @@index([origemTipo])
  @@index([fonteAusente])
  @@map("alunos")
}

model Enturmacao {
  id            String          @id @default(uuid())
  alunoId       String
  anoLetivo     String          @db.VarChar(10)
  regime        Int             @default(0)
  modalidade    String          @db.VarChar(100)
  turma         String          @db.VarChar(50)
  serie         String          @db.VarChar(10)
  turno         String?         @db.VarChar(20)
  origemTipo    String
  linhaOrigemId String?
  criadoEm      DateTime        @default(now())
  atualizadoEm  DateTime        @updatedAt
  fonteAusente  Boolean         @default(false)
  aluno         Aluno           @relation(fields: [alunoId], references: [id], onDelete: Cascade)
  linhaOrigem   LinhaImportada? @relation(fields: [linhaOrigemId], references: [id])

  @@index([alunoId])
  @@index([anoLetivo])
  @@index([modalidade])
  @@index([turma])
  @@map("enturmacoes")
}

model SerieCursada {
  id                 String    @id @default(uuid())
  alunoMatricula     String    @db.VarChar(15)
  anoLetivo          String    @db.VarChar(4)
  periodoLetivo      String    @db.VarChar(2)
  unidadeEnsino      String?   @db.VarChar(200)
  codigoEscola       String?   @db.VarChar(20)
  modalidade         String?   @db.VarChar(100)
  segmento           String?   @db.VarChar(100)
  curso              String?   @db.VarChar(200)
  serie              String?   @db.VarChar(100)
  turno              String?   @db.VarChar(20)
  situacao           String?   @db.VarChar(100)
  tipoVaga           String?   @db.VarChar(100)
  matrizCurricular   String?   @db.VarChar(100)
  dataInclusaoAluno  DateTime?
  tipoIngresso       String?   @db.VarChar(50)
  redeEnsinoOrigem   String?   @db.VarChar(100)
  ensinoReligioso    Boolean?
  linguaEstrangeira  Boolean?
  textoBrutoOrigemId String?
  criadoEm           DateTime  @default(now())
  atualizadoEm       DateTime  @updatedAt
  aluno              Aluno     @relation(fields: [alunoMatricula], references: [matricula], onDelete: Cascade)

  @@unique([alunoMatricula, modalidade, segmento, curso, serie])
  @@index([alunoMatricula])
  @@map("series_cursadas")
}

model Auditoria {
  id              String   @id @default(uuid())
  tabela          String   @db.VarChar(50)
  registroId      String
  operacao        String   @db.VarChar(10)
  dadosAntes      Json?
  dadosDepois     Json?
  camposAlterados String[]
  usuarioId       String?
  timestamp       DateTime @default(now())

  @@index([tabela, registroId])
  @@index([timestamp])
  @@index([usuarioId])
  @@map("auditoria")
}
